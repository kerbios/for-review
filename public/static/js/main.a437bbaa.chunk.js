(this.webpackJsonpclient=this.webpackJsonpclient||[]).push([[0],{77:function(e,t,n){},99:function(e,t,n){"use strict";n.r(t);var c=n(3),r=n(0),o=n.n(r),a=n(11),s=n.n(a),i=n(17),u=n(19),l=(n(77),n(122)),j=n(120),d=n(125),b=n(124),f=n(130),h=n(126),O=n(127),p=n(55),g=n.n(p),m=n(131),x=n(133),v=n(123),y=n(121),w=Object(j.a)((function(e){return{root:{flexGrow:1},menuButton:{marginRight:e.spacing(2)},title:{flexGrow:1}}})),E=function(e){var t=e.profile,n=w();return Object(c.jsx)("div",{className:n.root,children:Object(c.jsx)(x.a,{children:Object(c.jsxs)(l.a,{children:[Object(c.jsx)(v.a,{variant:"h6",className:n.title,children:"Test task chat application"}),function(){switch(!!t.id){case!1:return Object(c.jsx)(y.a,{color:"primary",variant:"contained",className:n.menuButton,children:Object(c.jsx)("a",{href:"/auth/google",children:"Login"})});default:return Object(c.jsx)(y.a,{color:"secondary",variant:"contained",className:n.menuButton,children:Object(c.jsx)("a",{href:"/auth/logout",children:"Logout"})})}}()]})})})},S=n(33),k=Object(j.a)((function(e){return{root:{flexGrow:1}}})),N=function(e){var t=e.from,n=e.message,r=(e.datetime,k());return Object(c.jsxs)(v.a,{className:r.root,children:[t,": ",n]})},C=function(e){var t=e.messages;return Object(c.jsx)(f.a,{children:t.map((function(e,t){return Object(c.jsx)(N,Object(S.a)({},e),t)}))})},B=n(25),F=n.n(B),L=n(41),G=n(42),M=n.n(G),T="FETCH_PROFILE",A="FETCH_MESSAGES",I="FETCH_MESSAGES_BULK",_=function(){var e=Object(L.a)(F.a.mark((function e(t){var n;return F.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,M.a.get("/auth/profile");case 2:n=e.sent,t({type:T,payload:n.data});case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),D=function(){var e=Object(L.a)(F.a.mark((function e(t){var n;return F.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,M.a.get("/api/messages");case 2:n=e.sent,t({type:I,payload:n.data});case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),H=function(){var e=Object(r.useRef)(),t=Object(i.b)();Object(r.useEffect)((function(){return e.current=new window.WebSocket("wss://"+window.location.host+"/channel")||{},e.current.onopen=function(){console.log("connection opened:")},e.current.onclose=function(e){console.log("connection closed:",e.code,e.reason)},e.current.onmessage=function(e){console.log("message:",e.data);var n=JSON.parse(e.data);t({type:A,payload:n})},function(){e.current.disconnect()}}),[]);return{sendMessage:function(t){t=Object(S.a)({type:"NEW_MESSAGE"},t),e.current.send(JSON.stringify(t))}}},J=Object(j.a)((function(e){return{root:{position:"fixed",bottom:e.spacing(2),right:e.spacing(2)}}}));function R(e){var t=e.children,n=e.window,r=J(),o=Object(b.a)({target:n?n():void 0,disableHysteresis:!0,threshold:100});return Object(c.jsx)(m.a,{in:o,children:Object(c.jsx)("div",{onClick:function(e){var t=(e.target.ownerDocument||document).querySelector("#back-to-top-anchor");t&&t.scrollIntoView({behavior:"smooth",block:"center"})},role:"presentation",className:r.root,children:t})})}var P=function(){var e=Object(i.c)((function(e){return e.profile})),t=Object(i.c)((function(e){return e.messages})),n=Object(i.b)();console.log("profile:",e),console.log("messages",t),Object(r.useEffect)((function(){console.log("App render"),_(n),D(n)}),[e.id]);var o=Object(r.useRef)(),a=H().sendMessage,s=function(){if(e.id){var t={from:e.googleId,to:"ALL",message:o.current.value};o.current.value="",a(t)}};return Object(c.jsxs)(f.a,{minWidth:300,children:[Object(c.jsx)(d.a,{}),Object(c.jsx)(E,{profile:e}),Object(c.jsx)(l.a,{id:"back-to-top-anchor"}),Object(c.jsxs)(h.a,{children:[Object(c.jsx)(f.a,{my:2,children:Object(c.jsx)(C,{messages:t})}),Object(c.jsxs)(f.a,{children:[Object(c.jsx)("input",{type:"text",ref:o,onKeyDown:function(e){13===e.keyCode&&s()}}),Object(c.jsx)("button",{onClick:s,children:"SEND"})]})]}),Object(c.jsx)(R,{children:Object(c.jsx)(O.a,{color:"secondary",size:"small","aria-label":"scroll back to top",children:Object(c.jsx)(g.a,{})})})]})},W={},q=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:W,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case T:return t.payload||!1;default:return e}},K=n(35),z=n(56),U=n.n(z),V=[],Q=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:V,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case A:return[].concat(Object(K.a)(e),[t.payload]);case I:return U.a.uniqBy([].concat(Object(K.a)(e),Object(K.a)(t.payload)),"uid");default:return e}},X=Object(u.c)({profile:q,messages:Q}),Y=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,135)).then((function(t){var n=t.getCLS,c=t.getFID,r=t.getFCP,o=t.getLCP,a=t.getTTFB;n(e),c(e),r(e),o(e),a(e)}))},Z=n(57),$=n(132),ee=n(129),te=n(128),ne=n(34),ce=Object(Z.a)({palette:{primary:{main:te.a[500]},secondary:{main:ne.a[500]},overrides:{Button:{color:"white"}}}});ce=Object($.a)(ce);var re=Object(u.d)(X,{},Object(u.a)());s.a.render(Object(c.jsx)(o.a.StrictMode,{children:Object(c.jsx)(i.a,{store:re,children:Object(c.jsx)(ee.a,{theme:ce,children:Object(c.jsx)(P,{})})})}),document.getElementById("root")),Y(console.log)}},[[99,1,2]]]);
//# sourceMappingURL=main.a437bbaa.chunk.js.map